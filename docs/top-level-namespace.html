<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Top Level Namespace
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo;
    
    
    <span class="title">Top Level Namespace</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Top Level Namespace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Comparison.html" title="Comparison (class)">Comparison</a></span>, <span class='object_link'><a href="OctAPI.html" title="OctAPI (class)">OctAPI</a></span>, <span class='object_link'><a href="TariffComparison.html" title="TariffComparison (class)">TariffComparison</a></span>, <span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="END_TIME-constant" class="">END_TIME =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2116-02-19</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#do_product-instance_method" title="#do_product (instance method)">#<strong>do_product</strong>(product, from_time, period_length, consumption, opts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#find_rate-instance_method" title="#find_rate (instance method)">#<strong>find_rate</strong>(ratelist, start, finish)  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find a rate applicable during an interval, in an array of intervals.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#mktime_from-instance_method" title="#mktime_from (instance method)">#<strong>mktime_from</strong>(timestr)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#mktime_to-instance_method" title="#mktime_to (instance method)">#<strong>mktime_to</strong>(timestr)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#output_consumption_as_csv-instance_method" title="#output_consumption_as_csv (instance method)">#<strong>output_consumption_as_csv</strong>(csv, results)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Output the consumption data to a CSV file, if selected The header row says “Date,” and then 00:00,00:30,01:00,01:30 etc.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#pence2pounds-instance_method" title="#pence2pounds (instance method)">#<strong>pence2pounds</strong>(p)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#print_product-instance_method" title="#print_product (instance method)">#<strong>print_product</strong>(code, product)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#print_tariff_charge-instance_method" title="#print_tariff_charge (instance method)">#<strong>print_tariff_charge</strong>(rate, rate_name = &#39;&#39;, rate_unit = &#39;p/kWh&#39;)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#print_tariff_summary-instance_method" title="#print_tariff_summary (instance method)">#<strong>print_tariff_summary</strong>(ts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#report_bucket-instance_method" title="#report_bucket (instance method)">#<strong>report_bucket</strong>(bucket, bucket_no, iter, start, sc)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="do_product-instance_method">
  
    #<strong>do_product</strong>(product, from_time, period_length, consumption, opts)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 151</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_product'>do_product</span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='comma'>,</span> <span class='id identifier rubyid_from_time'>from_time</span><span class='comma'>,</span> <span class='id identifier rubyid_period_length'>period_length</span><span class='comma'>,</span> <span class='id identifier rubyid_consumption'>consumption</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='comment'># Local variables:
</span>  <span class='comment'># @type [Time] from app-level period start
</span>  <span class='comment'># @type [Time] to app-level period end
</span>  <span class='comment'># @type [Time] start consumption slot start
</span>  <span class='comment'># @type [Time] finish consumption slot end
</span>  <span class='comment'># @type [Time] valid_from tariff slot start
</span>  <span class='comment'># @type [Time] valid_to tariff slot end
</span>  <span class='comment'># @type [Product] product
</span>  <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>specify a postcode to allow retrieval of tariff charges</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_print_product'><span class='object_link'><a href="#print_product-instance_method" title="#print_product (method)">print_product</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_product_code'>product_code</span><span class='comma'>,</span> <span class='id identifier rubyid_product'>product</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:products</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_total_tc'>total_tc</span> <span class='op'>=</span> <span class='id identifier rubyid_total_sc'>total_sc</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:compare</span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs'>tariffs</span><span class='lbracket'>[</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skipping product </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_product_code'>product_code</span><span class='embexpr_end'>}</span><span class='tstring_content'> as it has no tariffs for region </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs'>tariffs</span><span class='lbracket'>[</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tariff'>tariff</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_tariff_type'>tariff_type</span> <span class='op'>!=</span> <span class='symbol'>:sr_elec</span>
        <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skipping tariff </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_tariff_code'>tariff_code</span><span class='embexpr_end'>}</span><span class='tstring_content'> of type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_tariff_type'>tariff_type</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>
      <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Comparing to tariff </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_tariff_code'>tariff_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_bucket_marker'>bucket_marker</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_bucket'>bucket</span> <span class='op'>=</span> <span class='id identifier rubyid_standing_charge'>standing_charge</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_day_marker'>day_marker</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_consumption'>consumption</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_slot'>slot</span><span class='op'>|</span>
        <span class='id identifier rubyid_start'>start</span> <span class='op'>=</span> <span class='id identifier rubyid_mktime_from'><span class='object_link'><a href="#mktime_from-instance_method" title="#mktime_from (method)">mktime_from</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_slot'>slot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>interval_start</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_finish'>finish</span> <span class='op'>=</span> <span class='id identifier rubyid_mktime_to'><span class='object_link'><a href="#mktime_to-instance_method" title="#mktime_to (method)">mktime_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_slot'>slot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>interval_end</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_usage'>usage</span> <span class='op'>=</span> <span class='id identifier rubyid_slot'>slot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>consumption</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
        <span class='id identifier rubyid_bucket_number'>bucket_number</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_from_time'>from_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>/</span> <span class='id identifier rubyid_period_length'>period_length</span>
        <span class='id identifier rubyid_day_number'>day_number</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_from_time'>from_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>/</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_day_number'>day_number</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_day_marker'>day_marker</span>
          <span class='kw'>begin</span>
            <span class='id identifier rubyid_standing_charge'>standing_charge</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id identifier rubyid_day_number'>day_number</span> <span class='op'>-</span> <span class='id identifier rubyid_day_marker'>day_marker</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_find_rate'><span class='object_link'><a href="#find_rate-instance_method" title="#find_rate (method)">find_rate</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_sc'>sc</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_finish'>finish</span><span class='rparen'>)</span>
          <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
            <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>standing charge: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_day_marker'>day_marker</span> <span class='op'>=</span> <span class='id identifier rubyid_day_number'>day_number</span>
        <span class='kw'>end</span>

        <span class='comment'># End of period:
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_bucket_number'>bucket_number</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_bucket_marker'>bucket_marker</span>
          <span class='id identifier rubyid_report_bucket'><span class='object_link'><a href="#report_bucket-instance_method" title="#report_bucket (method)">report_bucket</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_bucket_number'>bucket_number</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span> <span class='op'>-</span> <span class='id identifier rubyid_from_time'>from_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_finish'>finish</span> <span class='op'>-</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_standing_charge'>standing_charge</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_total_sc'>total_sc</span> <span class='op'>+=</span> <span class='id identifier rubyid_standing_charge'>standing_charge</span>
          <span class='id identifier rubyid_total_tc'>total_tc</span> <span class='op'>+=</span> <span class='id identifier rubyid_bucket'>bucket</span>
          <span class='id identifier rubyid_bucket'>bucket</span> <span class='op'>=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_bucket_marker'>bucket_marker</span> <span class='op'>=</span> <span class='id identifier rubyid_bucket_number'>bucket_number</span>
          <span class='id identifier rubyid_standing_charge'>standing_charge</span> <span class='op'>=</span> <span class='int'>0</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_bucket'>bucket</span> <span class='op'>+=</span> <span class='id identifier rubyid_usage'>usage</span> <span class='op'>*</span> <span class='id identifier rubyid_find_rate'><span class='object_link'><a href="#find_rate-instance_method" title="#find_rate (method)">find_rate</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tariff'>tariff</span><span class='period'>.</span><span class='id identifier rubyid_sur'>sur</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_finish'>finish</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tariff charge: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='gvar'>$missing_rate</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_abort'>abort</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>too many missing rates</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='gvar'>$missing_rate</span> <span class='op'>&gt;</span> <span class='int'>5</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_total_sc'>total_sc</span><span class='comma'>,</span> <span class='id identifier rubyid_total_tc'>total_tc</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_rate-instance_method">
  
    #<strong>find_rate</strong>(ratelist, start, finish)  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find a rate applicable during an interval, in an array of intervals</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>ratelist</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of (valid_from, valid_to, value) tuples</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>start</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>start time of interval to search for</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finish</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>finish time of interval to search for</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the rate found</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_rate'>find_rate</span><span class='lparen'>(</span><span class='id identifier rubyid_ratelist'>ratelist</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_finish'>finish</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ratelist'>ratelist</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tslot'>tslot</span><span class='op'>|</span>
    <span class='id identifier rubyid_valid_from'>valid_from</span> <span class='op'>=</span> <span class='id identifier rubyid_mktime_from'><span class='object_link'><a href="#mktime_from-instance_method" title="#mktime_from (method)">mktime_from</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tslot'>tslot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valid_from</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_valid_to'>valid_to</span> <span class='op'>=</span> <span class='id identifier rubyid_mktime_to'><span class='object_link'><a href="#mktime_to-instance_method" title="#mktime_to (method)">mktime_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tslot'>tslot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valid_to</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_between?'>between?</span><span class='lparen'>(</span><span class='id identifier rubyid_valid_from'>valid_from</span><span class='comma'>,</span> <span class='id identifier rubyid_valid_to'>valid_to</span><span class='rparen'>)</span>
      <span class='comment'># $logger.debug(&quot;cons slot start #{start.to_s}: found rate slot #{valid_from.to_s} to #{valid_to.to_s}&quot;)
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_finish'>finish</span><span class='period'>.</span><span class='id identifier rubyid_between?'>between?</span><span class='lparen'>(</span><span class='id identifier rubyid_valid_from'>valid_from</span><span class='comma'>,</span> <span class='id identifier rubyid_valid_to'>valid_to</span><span class='rparen'>)</span>
        <span class='comment'># $logger.debug(&quot;...and it includes the finish time too: #{finish.to_s}&quot;)
</span>        <span class='kw'>return</span> <span class='id identifier rubyid_tslot'>tslot</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value_inc_vat</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
      <span class='kw'>else</span>
        <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>finish time of consumption time slot was after end of tariff validity slot</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='comment'>#abort(&#39;fatal error&#39;)
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no matching rate found for interval </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_finish'>finish</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'>#abort(&#39;fatal error&#39;)
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mktime_from-instance_method">
  
    #<strong>mktime_from</strong>(timestr)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mktime_from'>mktime_from</span><span class='lparen'>(</span><span class='id identifier rubyid_timestr'>timestr</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_timestr'>timestr</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_localtime'>localtime</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid__e'>_e</span>
  <span class='comment'>#$logger.debug(&quot;mktime_from: parsing &#39;#{timestr.inspect}&#39; gives #{e.to_s}&quot;)
</span>  <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mktime_to-instance_method">
  
    #<strong>mktime_to</strong>(timestr)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mktime_to'>mktime_to</span><span class='lparen'>(</span><span class='id identifier rubyid_timestr'>timestr</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_timestr'>timestr</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='const'><span class='object_link'><a href="#END_TIME-constant" title="END_TIME (constant)">END_TIME</a></span></span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_timestr'>timestr</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_localtime'>localtime</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mktime_to: parsing &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_timestr'>timestr</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; gives </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="#END_TIME-constant" title="END_TIME (constant)">END_TIME</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_consumption_as_csv-instance_method">
  
    #<strong>output_consumption_as_csv</strong>(csv, results)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Output the consumption data to a CSV file, if selected The header row says “Date,” and then 00:00,00:30,01:00,01:30 etc.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>csv</span>
      
      
        <span class='type'>(<tt>CSV</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>already-opened CSV object to write to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>results</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash{String=&gt;String,Float}&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of consumption slots</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_consumption_as_csv'>output_consumption_as_csv</span><span class='lparen'>(</span><span class='id identifier rubyid_csv'>csv</span><span class='comma'>,</span> <span class='id identifier rubyid_results'>results</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='int'>48</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_col'>col</span><span class='op'>|</span>
    <span class='id identifier rubyid_row'>row</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_col'>col</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>interval_start</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_getlocal'>getlocal</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%H:%M</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span>
  <span class='comment'>######
</span>  <span class='comment'># Each line in the table starts with YYYY-MM-DD and then real numbers giving consumption in kWh per slot
</span>  <span class='comment'>######
</span>  <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>/</span> <span class='int'>48</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rowno'>rowno</span><span class='op'>|</span>
    <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_row'>row</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="Time.html" title="Time (class)">Time</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>48</span> <span class='op'>*</span> <span class='id identifier rubyid_rowno'>rowno</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>interval_start</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_getlocal'>getlocal</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y-%m-%d</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='int'>48</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_col'>col</span><span class='op'>|</span>
      <span class='id identifier rubyid_row'>row</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>48</span> <span class='op'>*</span> <span class='id identifier rubyid_rowno'>rowno</span> <span class='op'>+</span> <span class='id identifier rubyid_col'>col</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>consumption</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pence2pounds-instance_method">
  
    #<strong>pence2pounds</strong>(p)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pence2pounds'>pence2pounds</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='float'>0.0</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>100.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_product-instance_method">
  
    #<strong>print_product</strong>(code, product)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_product'>print_product</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='id identifier rubyid_product'>product</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Product </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_code'>code</span><span class='embexpr_end'>}</span><span class='tstring_content'> \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_display_name'>display_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&quot; tariffs active at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs_active_at'>tariffs_active_at</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'>#puts &quot;Matching tariffs:&quot;
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs'>tariffs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  + No applicable tariffs</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span>
    <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs'>tariffs</span><span class='lbracket'>[</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_region'>region</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:print_tariff_summary</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_tariffs'>tariffs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__region'>_region</span><span class='comma'>,</span> <span class='id identifier rubyid_tslist'>tslist</span><span class='op'>|</span>
      <span class='id identifier rubyid_tslist'>tslist</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:print_tariff_summary</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_tariff_charge-instance_method">
  
    #<strong>print_tariff_charge</strong>(rate, rate_name = &#39;&#39;, rate_unit = &#39;p/kWh&#39;)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_tariff_charge'>print_tariff_charge</span><span class='lparen'>(</span><span class='id identifier rubyid_rate'>rate</span><span class='comma'>,</span> <span class='id identifier rubyid_rate_name'>rate_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_rate_unit'>rate_unit</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>p/kWh</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rate'>rate</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valid_from</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rate'>rate</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valid_to</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rate_name'>rate_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rate'>rate</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value_inc_vat</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rate_unit'>rate_unit</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_tariff_summary-instance_method">
  
    #<strong>print_tariff_summary</strong>(ts)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 61</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_tariff_summary'>print_tariff_summary</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tt'>tt</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="OctAPI.html" title="OctAPI (class)">OctAPI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_tariff_type_name'><span class='object_link'><a href="OctAPI.html#tariff_type_name-class_method" title="OctAPI.tariff_type_name (method)">tariff_type_name</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_tariff_type'>tariff_type</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_tariff_type'>tariff_type</span>
  <span class='kw'>when</span> <span class='symbol'>:sr_elec</span><span class='comma'>,</span> <span class='symbol'>:sr_gas</span>
      <span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Standard unit rate: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_sur_incvat'>sur_incvat</span><span class='embexpr_end'>}</span><span class='tstring_content'> p/kWh</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:dr_elec</span>
    <span class='id identifier rubyid_price'>price</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Day unit rate: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_dur_incvat'>dur_incvat</span><span class='embexpr_end'>}</span><span class='tstring_content'> p/kWh, Night unit rate: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_nur_incvat'>nur_incvat</span><span class='embexpr_end'>}</span><span class='tstring_content'> p/kWh</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown tariff type</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  + </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_tariff_code'>tariff_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tt'>tt</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_payment_model'>payment_model</span><span class='embexpr_end'>}</span><span class='tstring_content'>: Standing charge: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_sc_incvat'>sc_incvat</span><span class='embexpr_end'>}</span><span class='tstring_content'> p/day, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_price'>price</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_sc'>sc</span><span class='op'>&amp;.</span><span class='id identifier rubyid_reverse_each'>reverse_each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rate'>rate</span><span class='op'>|</span> <span class='id identifier rubyid_print_tariff_charge'><span class='object_link'><a href="#print_tariff_charge-instance_method" title="#print_tariff_charge (method)">print_tariff_charge</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rate'>rate</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Standard charge</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>p/day</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_sur'>sur</span><span class='op'>&amp;.</span><span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rate'>rate</span><span class='op'>|</span> <span class='id identifier rubyid_print_tariff_charge'><span class='object_link'><a href="#print_tariff_charge-instance_method" title="#print_tariff_charge (method)">print_tariff_charge</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rate'>rate</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Standard unit rate</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_dur'>dur</span><span class='op'>&amp;.</span><span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rate'>rate</span><span class='op'>|</span> <span class='id identifier rubyid_print_tariff_charge'><span class='object_link'><a href="#print_tariff_charge-instance_method" title="#print_tariff_charge (method)">print_tariff_charge</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rate'>rate</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Day unit rate</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_nur'>nur</span><span class='op'>&amp;.</span><span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rate'>rate</span><span class='op'>|</span> <span class='id identifier rubyid_print_tariff_charge'><span class='object_link'><a href="#print_tariff_charge-instance_method" title="#print_tariff_charge (method)">print_tariff_charge</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_rate'>rate</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Night unit rate</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="report_bucket-instance_method">
  
    #<strong>report_bucket</strong>(bucket, bucket_no, iter, start, sc)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'octoload.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_report_bucket'>report_bucket</span><span class='lparen'>(</span><span class='id identifier rubyid_bucket'>bucket</span><span class='comma'>,</span> <span class='id identifier rubyid_bucket_no'>bucket_no</span><span class='comma'>,</span> <span class='id identifier rubyid_iter'>iter</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_sc'>sc</span><span class='rparen'>)</span>
  <span class='gvar'>$logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>: bucket </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket_no'>bucket_no</span><span class='embexpr_end'>}</span><span class='tstring_content'> full after </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_iter'>iter</span><span class='embexpr_end'>}</span><span class='tstring_content'> iterations; sc: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sc'>sc</span><span class='embexpr_end'>}</span><span class='tstring_content'>; cost: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket'>bucket</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Dec 13 20:08:37 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>